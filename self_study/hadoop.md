# 하둡

## Scale-out vs Scale-up
- Scale-out: 많은, 값싼 서버
- Scale-up: 적은, 비싼 서버

서버의 성능은 가격에 비례해 선형으로 증가하는 것이 아니기 때문에 데이터 중심 앱 분야에서는 Scale-out을 선호한다.

### 데이터 중심 프로세싱 Data-intensive procesing
한대의 컴퓨터 능력으로 처리가 어려워 수 천대의 컴퓨터를 묶어서 처리하기도 한다.

맵리듀스는 빅데이터를 이용한 효율적인 계산이 가능한 첫 번째 프로그래밍 모델이다.

기존에는 프로그래머가 낮은 레벨의 시스템 세부 내용까지 아주 잘 알고 많은 시간을 쏟아야만 했다.

### 맵리듀스 프레임워크
빅데이터를 이요하는 응용분야에서 최근 주목 받고 있다.

값싼 컴퓨터들을 모아서 클러스터를 만들고 여기에서 빅데이터를 처리하기 위한 스케일러블 병렬 소프트웨어의 구현을 쉽게할 수 있도록 도와주는 프로그래밍 모델이다.

대표적으로 구글의 맵리듀스와, 하둡이 있다.

드라이버에 해당하는 메인 함수가 맵과 리듀스 함수를 호출해서 처리한다.

함수형 프로그래밍의 한 형태로 유저는 메인함수, 맵함수, 리듀스 함수를 구현해서 제공해야 한다.

맵 리듀스 프레임워크는 각각의 튜플/레코드를 (KEY-VALUE) 쌍으로 표현한다.

맵리듀스 프레임워크는 메인 함수를 한 개의 마스터 머신에서 수행하는데, 이 머신은 맵 함수를 수행하기 전에 전처리를 하거나 리듀스 함수의 결과를 후처리 하는데 사용할 수 있다.

컴퓨팅은 맵과 리듀스라는 유저가 정의한 함수 한 쌍으로 이루어진 맵리듀스 페이즈를 한번 수행하거나 여러 번 반복해서 수행할 수 있다.

한 번의 맵리듀스 페이즈는 맵 함수를 먼저 호출하고 그 다음에 리듀스 함수를 호출하는데 때에 따라서는 맵 함수가 끝난 후에 컴바인 함수를 중간에 수행할 수 있다.

### 맵리듀스 페이즈

1. 맵 페이즈
  제일 먼저 수행되며, 데이터의 여러 파티션에 병렬 분산으로 호출되어 수행된다.
  각 머신마다 수행된 Mapper는 맵 함수가 입력 데이터의 한 줄마다 맵 함수를 호출한다.
  Map 함수는 (KEY-VALUE) 쌍 형태로 결과를 출력하고 여러 머신에 나누어 보내며 같은 KEY값을 가진 쌍은 같은 머신으로 보내진다.

2. 셔플링 페이즈
  모든 머신에서 맵 페이즈가 끝나면 시작된다.
  맵 페이즈에서 보낸 (KEY-VALUE)쌍을 모아 value_list를 만든 뒤 (KEY - value_list)의 형태로 KEY에 따라 여러 머신에 분산해서 보낸다.

3. 리듀스 페이즈
  모든 머신에서 셔플링 페이즈가 다 끝나면 각 머신마다 리듀스 페이즈가 시작된다.
  각각의 머신에서는 셔플링 페이즈에서 해당 머신으로 보내진 각각의 (KEY- value_list)쌍마다 리듀스함수가 호출되며, 출력이 있다면 (KEY-VALUE)쌍 형태로 출력한다.


## Hadoop
Apache 프로젝트의 맵리듀스 프레임워크의 오픈 소스

### HDFS, Hadoop Distributed File System
빅데이터 파일을 여러 대의 컴퓨터에 나누어서 저장하고, 각 파일은 여러 개의 순차적인 블록으로 저장한다. 

하나의 파일의 각각의 블록은 Fault Tolerance를 위해 여러개로 복사되어 여러 머신의 여기저기에 저장된다.
이를 통해 몇몇 블록들에 결함이 발생하더라도, 정상적/부분적으로 기능을 수행할 수 있게 유지한다.

### 주요 구성 요소
- MapReduce: 소프트웨어의 수행을 분산
- HDFS: 데이터를 분산

### Namenode와 Datanode
Hadoop은 master-slave 구조를 가진다.
- Namenode(master): 파일 시스템을 관리하고 클라이언트가 파일에 접근할 수 있게 한다.

- Datanode(slave): 컴퓨터에 들어있는 데이터를 접근할 수 있게 한다.

## Java에서의 MapReduce

### `Map`
`org.apache.hadoop.mapreduce` 패키지 내의 `Mapper` 클래스를 상속받아 `map method`를 수정한다.

입력은 텍스트 파일에서 라인 단위로 호출되고, 입력은 키-밸류의 형태로 주어진다.

`KEY`는 입력 텍스트 파일에서 맨 앞문자를 기준으로 맵 함수가 호출된 해당 라인의 첫 번째 문자까지의 오프셋이다.

`VALUE`는 텍스트의 해당 라인 전체가 들어있다.

### `Reduce`
`org.apache.hadoop.mapreduce` 패키지 내의 `Reducer` 클래스를 상속받아 `reduce method`를 수정한다.
